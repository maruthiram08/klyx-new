services:
  # Background Worker API - Runs continuously
  - type: web
    name: klyx-worker
    runtime: python
    region: singapore
    plan: free
    repo: https://github.com/maruthiram08/klyx-new
    buildCommand: pip install -r frontend/backend/requirements.txt
    startCommand: python frontend/backend/worker_app.py
    healthCheckPath: /health
    envVars:
      - key: POSTGRES_URL
        sync: false
      - key: DATABASE_URL
        sync: false
      - key: GOOGLE_API_KEY
        sync: false
      - key: ALPHA_VANTAGE_API_KEY
        sync: false
      - key: WORKER_API_KEY
        sync: false

  # Cron Job: Daily stock price refresh - Mon-Fri 6:30 PM IST (1:00 PM UTC)
  - type: cron
    name: daily-price-refresh
    runtime: python
    region: singapore
    plan: free
    repo: https://github.com/maruthiram08/klyx-new
    schedule: "0 13 * * 1-5"
    buildCommand: pip install requests
    startCommand: "python -c \"import requests; requests.post('https://klyx-worker.onrender.com/worker/refresh')\""

  # Cron Job: Weekly enrichment - Sunday 6 AM IST (12:30 AM UTC)
  - type: cron
    name: weekly-enrichment
    runtime: python
    region: singapore
    plan: free
    repo: https://github.com/maruthiram08/klyx-new
    schedule: "30 0 * * 0"
    buildCommand: pip install requests
    startCommand: "python -c \"import requests; requests.post('https://klyx-worker.onrender.com/worker/enrich', json={'batch_size': 100})\""

  # Cron Job: Daily MoneyControl sync - Mon-Fri 7 PM IST (1:30 PM UTC)
  - type: cron
    name: daily-fundamentals-sync
    runtime: python
    region: singapore
    plan: free
    repo: https://github.com/maruthiram08/klyx-new
    schedule: "30 13 * * 1-5"
    buildCommand: pip install requests
    startCommand: "python -c \"import requests; requests.post('https://klyx-worker.onrender.com/worker/sync-fundamentals')\""
